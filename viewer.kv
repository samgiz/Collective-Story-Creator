#:import Factory kivy.factory.Factory
#:import Path pathlib.Path
#:import Story Viewer.Story

RootWidget:
	current: self.lastScreen[-1]
	MenuScreen
	PauseScreen
	GameScreen
	OptionsScreen
	NewGameScreen

<MenuScreen>:
	name: "menu"
	BoxLayout:
		orientation: 'vertical'
		Button:
			text: "Continue"
			disabled: root.manager.currentStory == None
			on_release: app.root.current = "game"
		Button:
			text: "New Game"
			on_release: app.root.current = "load"
		Button:
			text: "Options"
			on_release: app.root.current = "options"
		Button:
			text: "Quit"
			on_release: app.stop()

<PauseScreen>:
	name: "pause"
	BoxLayout:
		orientation: 'vertical'
		BackButton:
			text: "Resume"
		Button:
			text: "Main Menu"
			on_release: app.root.current = "menu"
		Button:
			text: "Options"
			on_release: app.root.current = "options"

<GameScreen>:
	name: "game"
	currentStory: self.manager.currentStory
	on_enter: self.update(updateState = False)

<OptionsScreen>:
	name: "options"
	BoxLayout:
		orientation: "vertical"
		BackButton

<NewGameScreen>:
	name: "load"
	BoxLayout:
		BackButton:
		RecycleView:
			id: listview
			data: root.storyList
			viewclass: "StoryListViewButton"
			RecycleBoxLayout
				
		Button:
			text: "Load new game"
			on_release: Factory.LoadPopup(caller=root).open()

<LoadStoryChooser>:

<LoadPopup>:
	BoxLayout:
		LoadStoryChooser:
			path: str(Path.home())
			dirselect: True
			id: loader
		BoxLayout:
			orientation: "horizontal"
			Button:
				text: "Cancel"
				on_release: root.dismiss()
			Button:
				text: "Load Game"
				## this needs additional functionality
				on_release:
					root.dismiss()
					if loader.selection != []:root.caller.addNewStory(loader.selection[0])
					

<ChoiceButton>:
	
<StoryText>:
	font_size: 30

<Button>:
	on_release:
		## trying to be smart about saving the last screen only when necessary; seems to work
		if app.root.current == "menu": app.root.lastScreen = ["menu"]
		if app.root.current != app.root.lastScreen[-1]: app.root.lastScreen.append(app.root.current)

		## for dubugging purposes
		print(app.root.lastScreen)

<StoryEndButton>:
	text: "Back to Main Menu"
	on_release: 
		app.root.current = "menu"
		app.root.currentStory = None

<BackButton>: 
	text: "Back"
	on_release: app.root.lastScreen.pop()

<StoryListViewButton>:
	on_release:
		app.root.currentStory = Story(self.folder)
		app.root.current = "game"

<BoxLayout>:
	orientation: "vertical"